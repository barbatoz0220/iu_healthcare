doctype html
html(lang='en')
   head
      title Homepage
      link(rel="stylesheet", href="/styles/form.css")
   body
      div(id="container")
         include ../../components/doctorList.pug
         //- ul
         //- each doctor in doctors
         //-       li
         //-          input(type='text', name='name', value = doctor.NAME, required='', readonly=true)
         //-          input(type='text', name='dob', value = doctor.DOB, required='', readonly=true)
         //-          input(type='text', name='gender', value = doctor.GENDER, required='', readonly=true)
         //-          input(type='text', name='phone', value = doctor.PHONE, required='', readonly=true)
         //-          button(type="button" onclick='deleteDoctor('+doctor.ID+')') Delete
         //-          button(type="button", class="update-button", onclick='getIndex(' + doctor.ID + ')') Update
         //-          form(class="update-form" id=doctor.ID action="/admin/doctor-list/update/" + doctor.ID, method="POST" onsubmit="return submitAddForm(this)" enctype="multipart/form-data")
         //-             input(type='text', name='name', required='')
         //-             input(type='text', name='dob', required='')
         //-             input(type='text', name='gender', required='')
         //-             input(type='text', name='phone', required='')
         //-             input(type="submit" value="Done")
      div
         button(type="button" id="insert-button") Add doctor
         form(id="insert-form" action="/admin/doctor-list/insert" method="POST" onsubmit="return submitAddForm(this)" enctype="multipart/form-data")
            input(type='text', name='name', required='')
            input(type='text', name='dob', required='')
            input(type='text', name='gender', required='')
            input(type='text', name='phone', required='')
            input(type="submit" value="Add")
      script(src="https://code.jquery.com/jquery-3.5.1.min.js")
      script.
         function getIndex(index) {
            $("#" + index).toggle();
         };
         $("#insert-button").click(function(){
            $("#insert-form").toggle();
         });
         function deleteDoctor(index) {
            //- var req = new XMLHttpRequest();
            //- req.open("GET", "/admin/doctor-list/delete/" + index);
            //- req.onreadystatechange = function(){
            //-    if(req.readyState == 4 && req.status == 200){
            //-       document.getElementById("container").innerHTML = req.responseText;
            //-    }
            //- }
            //- req.send(); 
            fetch("/admin/doctor-list/delete/" + index).then(function(response) {
               return response.text().then(function(text) {
                  document.getElementById("container").innerHTML = text;
               });
            });
         };

         function submitAddForm(form) {
            var formData = {
               'name'              :     form.name.value,
               'dob'               :     form.dob.value,
               'gender'            :     form.gender.value,
               'phone'             :     form.phone.value
            };
            var req = new XMLHttpRequest();
            req.open(form.getAttribute("method"), form.getAttribute("action"), true);
            req.onreadystatechange = function(){
               if(req.readyState == 4 && req.status == 200){
                  document.getElementById("container").innerHTML = req.responseText;
               }
            }
            req.setRequestHeader('Content-Type','application/json');
            req.send(JSON.stringify(formData));
            return false;
         };

         function submitUpdateForm(form) {
            var formData = {
               'name'              :     form.name.value,
               'dob'               :     form.dob.value,
               'gender'            :     form.gender.value,
               'phone'             :     form.phone.value
            };
            var req = new XMLHttpRequest();
            req.open(form.getAttribute("method"), form.getAttribute("action"), true);
            req.onreadystatechange = function(){
               if(req.readyState == 4 && req.status == 200){
                  document.getElementById("container").innerHTML = req.responseText;
               }
            }
            req.setRequestHeader('Content-Type','application/json');
            req.send(JSON.stringify(formData));
            return false;
         };

